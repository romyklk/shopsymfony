{% extends 'base.html.twig' %}

{% block title %}Compte MyShOp|
	{{parent()}}
{% endblock %}

{% block body %}
	<div class="container">
		<div class="row">
			<div class="col-md-12 justify-content-center align-items-center text-center">
				<h1>Account
				</h1>
				<p>Bienvenue sur votre compte
					{{app.user.firstname|capitalize}}
					{{app.user.lastname|upper}}!</p>
				<p>Vous pouvez modifier vos informations personnelles ou consulter vos commandes.</p>
			</div>
		</div>

		<div class="row">
			<div class="col-md-3">

				<ul class="list-group">
					<div class=" list-group-item col-md-12 fw-bold text-center bg-secondary">
						<a href="{{path('app_account')}}" class='text-white text-decoration-none'>DASHBORD</a>
					</div>
					<li class="list-group-item">
						<a href="" class="text-dark text-decoration-none">Mes informations</a>
					</li>
					<li class="list-group-item">
						<a href="{{path('app_forgot_password_request')}}" class="text-dark text-decoration-none">Mot de passe</a>
					</li>
					<li class="list-group-item">
						<a href="" class="text-dark text-decoration-none">Mes adresses</a>
					</li>
					<li class="list-group-item">
						<a href="" class="text-dark text-decoration-none">Mes commandes</a>
					</li>
					<li class="list-group-item">
						<a href="{{path('app_logout')}}" class="text-dark text-decoration-none">Logout</a>
					</li>
				</ul>
			</div>

			<div class="col-md-9">
				<div
					class="card">

					{# Afficher les messages flash#}
					{% for message in app.flashes('success') %}
						<div class="card-header">
							<div
								class="alert alert-success alert-dismissible fade show" role="alert">
								{{message}}								
								<button type="button" class="btn-close" data-bs-dismiss="alert" aria-label="Close"></button>

							</div>
						</div>
					{% endfor %}
					{% for message in app.flashes('danger') %}
						<div class="card-header">
							<div class="alert alert-danger alert-dismissible fade show" role="alert">
								{{message}}
								<button type="button" class="btn-close" data-bs-dismiss="alert" aria-label="Close"></button>
							</div>
						</div>
					{% endfor %}

					<div class="card-header">
						<h3>Mon compte</h3>
					</div>
					<div class="card-body">
						<div class="row">
							<div class="col-md-6">
								<h4>Informations personnelles</h4>
								<div class="col-md-8">
									<div class="form-group">
										<label for="username">Username</label>
										<input type="text" class="form-control" id="username" name="username" value="{{app.user.username}}" disabled>
									</div>


									<div class="form-group">
										<label for="firstname">Prénom</label>
										<input type="text" class="form-control" id="firstname" name="firstname" value="{{app.user.firstname}}" disabled>
									</div>

									<div class="form-group">
										<label for="lastname">Nom</label>
										<input type="text" class="form-control" id="lastname" name="lastname" value="{{app.user.lastname}}" disabled>
									</div>

									<div class="form-group">
										<label for="email">Email</label>
										<input type="email" class="form-control" id="email" name="email" value="{{app.user.email}}" disabled>
									</div>

									<button type="button" class="btn btn-primary mt-3 " data-bs-toggle="modal" data-bs-target="#modify">
										Modifier mes informations
									</button>

									<div class="modal fade" id="modify" tabindex="-1" aria-labelledby="modifyLabel" aria-hidden="true">
										<div class="modal-dialog">
											<div class="modal-content">
												<div class="modal-header">
													<h5 class="modal-title" id="modifyLabel">
														<i class="bi bi-person-circle"></i>
														Mes informations</h5>
													<button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
												</div>
												<div class="modal-body">
													<form action="" method="post" name='modify'>
														<div class="row">
															<div class="col-md-6 form-group">
																<label for="firstname">Prénom</label>
																<input type="text" class="form-control" id="firstname" name="firstname" value="{{app.user.firstname}}">
															</div>

															<div class="col-md-6 form-group">
																<label for="lastname">Nom</label>
																<input type="text" class="form-control" id="lastname" name="lastname" value="{{app.user.lastname}}">
															</div>

															<div class="col-md-12 form-group">
																<label for="email">Email</label>
																<input type="email" class="form-control" id="email" name="email" value="{{app.user.email}}">
															</div>

															<div class="col-md-12 form-group">
																<label for="username">Username</label>
																<input type="text" class="form-control" id="username" name="username" value="{{app.user.username}}">
															</div>

															<div class="col-md-12 form-group">
																<label for="password">Nouveau ot de passe</label>
																<input type="password" class="form-control" id="password" name="password">

															</div>

															<div class="col-md-12 form-group">
																<label for="password_confirm">Confirmer le mot de passe</label>
																<input type="password" class="form-control" id="password_confirm" name="password_confirm">
															</div>
														</div>

													</div>
													<div class="modal-footer">
														<button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Annuler</button>
														<button type="button" class="btn btn-primary">Valider</button>
													</div>
												</form>
											</div>
										</div>
									</div>
								</div>
							</div>
							<div class="col-md-6">
								<h4>Adresse de livraison</h4>
								<a href="{{path('app_address_new')}}" class='btn btn-outline-primary mb-4'>Ajouter Une Nouvelle Adresse</a>
								<div class="col-md-9">
									{% if(app.user.addresses is not empty) %}{# si l'utilisateur a des adresses #}
									{% set index = 0 %} {# on initialise un compteur #}
										{% for address in app.user.addresses %}
											{% set index = index + 1 %}
											<div class="card border-success mb-3" style="max-width: 18rem;">
												<div class="card-header bg-transparent border-success d-flex justify-content-around">
													<h5 class="card-title d-inline text-center">{{address.fullName}}</h5> <p>Adresse #{{index}}</p>
												</div>
												<div class="card-body text-success">
													<p class="card-text">{{address.address}}<br>
														{% if address.complement is not null %}
															{{address.complement}}<br>
														{% endif %}

														{{address.phone}}<br>

														{{address.codePostal}}
														<span>{{address.city}}</span>
														<span>{{address.country}}</span>
													</p>

												</div>
												<div class="d-flex justify-content-around">
													<div class="card-footer bg-transparent border-success">
														<a href="{{path('app_address_edit',{'id':address.id})}}" class="btn btn-warning">Modifier</a>
														<a href="" class="btn">
															<form method="post" action="{{ path('app_address_delete', {'id': address.id}) }}" onsubmit="return confirm('Êtes-vous sûr de bien vouloir supprimer cette adresse ??');">
																<input type="hidden" name="_token" value="{{ csrf_token('delete' ~ address.id) }}">
																<button class="btn btn-danger">Supprimer</button>
															</form>

														</a>
													</div>
												</div>
											</div>
										{% endfor %}

									{% else %}
										<div class="card border-danger mb-3" style="max-width: 18rem;">
											<div class="card-header bg-transparent border-danger"></div>
											<div class="card-body text-danger">
												<p class="card-text">Aucune adresse enregistrée</p>
											</div>
											<div class="card-footer bg-transparent border-danger">
												<button type="button" class="btn btn-primary" data-bs-toggle="modal" data-bs-target="#modifyAddress">
													Ajouter
												</button>
											</div>
										</div>
									{% endif %}

								</div>
							</div>
						</div>
					</div>
				</div>
			</div>
		</div>
	</div>
{% endblock %}
